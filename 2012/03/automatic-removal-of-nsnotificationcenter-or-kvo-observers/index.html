<!DOCTYPE HTML> <html> <head> <meta charset="utf-8"> <title>Automatic removal of NSNotificationCenter or KVO observers - Krzysztof Zabłocki</title> <meta name="author" content="Krzysztof Zabłocki"> <meta name=”twitter:site” content=”@merowing_> <meta name="description" content="Automatic removal of NSNotificationCenter or KVO observers Observer pattern is common on iOS platform, you use observers in NSNotificationCenter and &hellip;"> <meta name="HandheldFriendly" content="True"> <meta name="MobileOptimized" content="320"> <meta name="viewport" content="width=device-width, initial-scale=1"> <link href="/atom.xml" rel="alternate" title="Krzysztof Zabłocki" type="application/atom+xml"> <link rel="canonical" href="http://merowing.info/2012/03/automatic-removal-of-nsnotificationcenter-or-kvo-observers"> <link href="/favicon.png" rel="shortcut icon"> <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css"> <link href="/stylesheets/font-awesome.min.css" media="screen, projection" rel="stylesheet" type="text/css"> <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]--> <link href='http://fonts.googleapis.com/css?family=Nunito:400,300,700' rel='stylesheet' type='text/css'> <script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script> <style type="text/css">
  .fancybox-wrap { position: fixed !important; }
  .fancybox-opened {
    -webkit-border-radius: 4px !important;
       -moz-border-radius: 4px !important;
            border-radius: 4px !important;
  }
  .fancybox-close, .fancybox-prev span, .fancybox-next span {
    background-color: transparent !important;
    border: 0 !important;
  }
</style> <script type="text/javascript">
		var _gaq = _gaq || [];
		_gaq.push(['_setAccount', 'UA-29400340-1']);
		_gaq.push(['_trackPageview']);

		(function() {
			var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		})();

		$('a').click(function() { 
			var $a = $(this); var href = $a.attr('href');
			// see if the link is external 
			if ( (href.match(/^http/)) && (! href.match(document.domain)) ) {

			// if so, register an event
			var category = 'outgoing'; // set this to whatever you want
			var event = 'click'; // set this to whatever you want
			var label = href; // set this to whatever you want
			pageTracker._trackEvent(category, event, href);
			}});
	</script> </head> <body> <div class="container"> <div class="left-col"> <div class="intrude-less"> <header id="header" class="inner"><div class="profilepic"> <script src="/javascripts/md5.js"></script> <script type="text/javascript">
		$(function(){
			$('.profilepic').append("<a href='http://twitter.com/merowing_'><img src='http://www.gravatar.com/avatar/" + MD5("krzysztof.zablocki@pixle.pl") + "?s=120' alt='Profile Picture' style='width: 120px; float: left; margin: 0px 15px 15px 0px;' /></a> <div class='header_bio'><a href='/about/''>Krzysztof Zabłocki - Software Engineer.</a></div>");
		});
	</script> </div> <nav id="main-nav"><ul class="main"> <br/> <br/> <div class="indie_apps" style="clear:both;"> <a href="http://appstore.com/foldify"><img class="app_poster" src="http://www.merowing.info/images/foldify.png" alt="Foldify"></a> <a href="http://appstore.com/foldifyzoo"><img class="app_poster" src="http://www.merowing.info/images/foldifyzoo.png" alt="Foldify Zoo"></a> <a href="http://appstore.com/foldifydino"><img class="app_poster" src="http://www.merowing.info/images/foldifydino.png" alt="Foldify Dino"></a> <a href="https://itunes.apple.com/us/app/storest-kids-love-playing/id926102013?mt=8"><img class="app_poster" src="http://www.merowing.info/images/storest.png" alt="Bord"></a> <a href="http://appstore.com/bord"><img class="app_poster" src="http://www.merowing.info/images/bord.png" alt="Storest"></a> <br/> <br/> </div> <li><a href="/about">About me</a></li> <li><a href="/speaking">Speaking</a></li> <li><a href="/">Blog</a></li> <li><a href="/blog/archives">Archives</a></li> </ul> </nav> <nav id="popular"> <section> <h4>Recommended</h4> <li class="related"><a href="/2014/10/how-do-i-work/">How do I Work?</a></li> <li class="related"><a href="/2014/03/refactoring-tricks">Refactoring tricks</a> and <a href="/2014/02/ios-developer-tools">Developer Tools</a></li> <li class="related"><a href="/2012/04/drawing-smooth-lines-with-cocos2d-ios-inspired-by-paper">Drawing smooth lines</a></li> <li class="related"><a href="https://github.com/krzysztofzablocki/KZPropertyMapper">Data Parsing</a> and <a href="https://github.com/krzysztofzablocki/KZBootstrap">Project bootstrap</a></li> </section> </nav> <nav id="sub-nav"> <div class="social"> <a class="email" href="mailto:krzysztof.zablocki@pixle.pl" title="Email">Email</a> <a class="facebook" href="http://www.facebook.com/100000315956630" title="Facebook">Facebook</a> <a class="twitter" href="http://twitter.com/merowing_" title="Twitter">Twitter</a> <a class="github" href="https://github.com/krzysztofzablocki" title="GitHub">GitHub</a> <a class="linkedin" href="http://www.linkedin.com/profile/view?id=90077810" title="LinkedIn">LinkedIn</a> <a class="rss" href="/atom.xml" title="RSS">RSS</a> </div> </nav></header> </div> </div> <div class="mid-col"> <div class="mid-col-container"> <div id="content" class="inner"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"> <h1 class="title" itemprop="name">Automatic removal of NSNotificationCenter or KVO observers</h1> <div class="entry-content" itemprop="articleBody"><p>Observer pattern is common on iOS platform, you use observers in NSNotificationCenter and in Key Value Observing. You need to remember to unregister before you release your observer object, if you don’t you are going to have crashes.For example notification get posted and system tries to inform deallocated object about it, and it crashes.</p> <p>I’ve created a simple category that takes care of this problem, whenever an object that is observing (NSNotification or KVO) it’s going to be deallocated, it will be unregistered in those systems. The category that I’ve created doesn’t require you to call special methods or do anything fancy. Just include it and you have auto-removal working. It works on both ARC and non ARC code without any settings…</p> <p>You can <a href="https://github.com/krzysztofzablocki/SFObservers">grab it from GitHub</a> or read more to learn about few tricks I’ve used to make it happen.</p> <h2>Idea</h2> <p>There are actually 2 categories, one for NSNotificationCenter and second for KVO. They use very similar code so I will just explain a few tricks used to make it work. You are free to look at whole code but I will explain only key points…</p> <p>Since I wanted to have a category that doesn’t require changing code in existing apps, that meant that the methods you are going to use must stay the same, no custom methods calling or additional code needed to be called. That means I have to swizzle the existing methods with my own.</p> <p>It should happen only once and it should happen automaticlly, my first thought was</p> <div> <figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="k">+</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">initialize</span>
</span></code></pre></td></tr></table></div></figure> </div> <p>this method is called when a class is used for first time, but I’m not subclassing but creating categories so it wouldn’t work correctly. Instead I decided to use <strong>%2B(void)load</strong> as it gets called even for categories. But remember that load is called before main, so you don’t have normal autorelease pool, you need to create one:</p> <div> <button class='toggle-code' title='show'>Show Code</button><figure class='code hide'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">load</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="c1">//! swap methods</span>
</span><span class='line'>  <span class="k">static</span> <span class="n">dispatch_once_t</span> <span class="n">onceToken</span><span class="p">;</span>
</span><span class='line'>  <span class="n">dispatch_once</span><span class="p">(</span><span class="o">&amp;</span><span class="n">onceToken</span><span class="p">,</span> <span class="o">^</span><span class="p">{</span>
</span><span class='line'>    <span class="err">@</span><span class="n">autoreleasepool</span> <span class="p">{</span>
</span><span class='line'>      <span class="p">[</span><span class="n">self</span> <span class="nl">sf_swapSelector:</span><span class="k">@selector</span><span class="p">(</span><span class="nl">addObserver:forKeyPath:options:context:</span><span class="p">)</span> <span class="nl">withSelector:</span><span class="k">@selector</span><span class="p">(</span><span class="nl">sf_addObserver:forKeyPath:options:context:</span><span class="p">)];</span>
</span><span class='line'>      <span class="p">[</span><span class="n">self</span> <span class="nl">sf_swapSelector:</span><span class="k">@selector</span><span class="p">(</span><span class="nl">removeObserver:forKeyPath:</span><span class="p">)</span> <span class="nl">withSelector:</span><span class="k">@selector</span><span class="p">(</span><span class="nl">sf_removeObserver:forKeyPath:</span><span class="p">)];</span>
</span><span class='line'>      <span class="p">[</span><span class="n">self</span> <span class="nl">sf_swapSelector:</span><span class="k">@selector</span><span class="p">(</span><span class="nl">removeObserver:forKeyPath:context:</span><span class="p">)</span> <span class="nl">withSelector:</span><span class="k">@selector</span><span class="p">(</span><span class="nl">sf_removeObserver:forKeyPath:context:</span><span class="p">)];</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>  <span class="p">});</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure> </div> <p>sf_swapSelector changes default selectors to call sf_ prefixed ones, it also creates a new selectors called sf_original_”originalSelector” that point to original code.</p> <h2>Data storage</h2> <p>Next time someone adds / removes observer we need to store that data so that we can operate on it later. Since we need this data when working with the observer object we should store it inside it. <strong>We can use associated references for that.</strong></p> <p>I have used Dictionary of Arrays ( key is actually keyPath ) of internal object named __SFObserverKVOObserverInfo that looks as simple as that:</p> <div> <button class='toggle-code' title='show'>Show Code</button><figure class='code hide'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="k">@interface</span> <span class="nc">__SFObserversKVOObserverInfo</span> : <span class="nc">NSObject</span>
</span><span class='line'><span class="k">@property</span><span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">copy</span><span class="p">)</span> <span class="n">NSString</span> <span class="o">*</span><span class="n">keyPath</span><span class="p">;</span>
</span><span class='line'><span class="k">@property</span><span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">AH_WEAK</span><span class="p">)</span> <span class="kt">id</span> <span class="n">context</span><span class="p">;</span>
</span><span class='line'><span class="k">@property</span><span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">assign</span><span class="p">)</span> <span class="kt">void</span> <span class="o">*</span><span class="n">blockKey</span><span class="p">;</span>
</span><span class='line'><span class="k">@end</span>
</span></code></pre></td></tr></table></div></figure> </div> <p></p> <p>keyPath and context are self explanatory, blockKey is a key used to access block created by <a href="https://github.com/krzysztofzablocki/NSObject-SFExecuteOnDealloc">SFExecuteOnDealloc</a>( very handy category that allows you to execute any block when an object get’s deallocated, useful especially when you create advanced categories like this one ).</p> <h2>Execute on dealloc</h2> <p>Each time we add new observer, we need to make sure that it will be deallocated automatically, this is the place that SFExecuteOnDealloc get’s really useful:</p> <div> <button class='toggle-code' title='show'>Show Code</button><figure class='code hide'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="c1">//! 1</span>
</span><span class='line'><span class="n">__unsafe_unretained</span> <span class="n">__block</span> <span class="kt">id</span> <span class="n">weakSelf</span> <span class="o">=</span> <span class="n">self</span><span class="p">;</span>
</span><span class='line'><span class="n">__unsafe_unretained</span> <span class="n">__block</span> <span class="kt">id</span> <span class="n">weakObserver</span> <span class="o">=</span> <span class="n">observer</span><span class="p">;</span>
</span><span class='line'><span class="n">__unsafe_unretained</span> <span class="n">__block</span> <span class="kt">id</span> <span class="n">weakContext</span> <span class="o">=</span> <span class="n">aContext</span><span class="p">;</span>
</span><span class='line'><span class="c1">//! 2</span>
</span><span class='line'><span class="kt">void</span> <span class="o">*</span><span class="n">key</span> <span class="o">=</span> <span class="p">[</span><span class="n">observer</span> <span class="nl">performBlockOnDealloc:</span><span class="o">^</span><span class="p">{</span>
</span><span class='line'><span class="c1">//! 3</span>
</span><span class='line'>  <span class="k">if</span> <span class="p">([</span><span class="n">weakSelf</span> <span class="nl">sf_removeObserver:</span><span class="n">weakObserver</span> <span class="nl">forKeyPath:</span><span class="n">keyPath</span> <span class="nl">context:</span><span class="n">weakContext</span> <span class="nl">registeredKeyPaths:</span><span class="n">registeredKeyPaths</span><span class="p">])</span> <span class="p">{</span>
</span><span class='line'>    <span class="c1">//! 4</span>
</span><span class='line'>    <span class="p">[</span><span class="n">self</span> <span class="nl">setAllowMethodForwarding:</span><span class="n">YES</span><span class="p">];</span>
</span><span class='line'>    <span class="c1">//! 5</span>
</span><span class='line'>    <span class="n">objc_msgSend</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">NSSelectorFromString</span><span class="p">(</span><span class="n">NSObjectKVOSFObserversRemoveSpecificSelector</span><span class="p">),</span> <span class="n">weakObserver</span><span class="p">,</span> <span class="n">keyPath</span><span class="p">,</span> <span class="n">weakContext</span><span class="p">);</span>
</span><span class='line'>    <span class="p">[</span><span class="n">self</span> <span class="nl">setAllowMethodForwarding:</span><span class="n">NO</span><span class="p">];</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}];</span>
</span></code></pre></td></tr></table></div></figure> </div> <ol> <li><strong>__unsafe_unretained __block </strong>specifier breaks retain cycles on both ARC and non ARC code, and since we are using block we need to make sure we do not create retain cycle ( any obj-c object without it inside a block will automatically be retained as long as the block exists )</li> <li>We add a new block to be executed when observer get’s deallocated</li> <li>We check and remove data from our internal structure for specified options, it will return YES if something was actually removed ( prevents removal of objects that isn’t observer anymore )</li> <li>Enables method forwarding, more on this later…</li> <li>Calls original method, we are using<strong> NSSelectorFromString to prevent compiler warnings about unknown selectors, just a clever trick I came up with.</strong></li> </ol> <h2>Method Forwarding</h2> <p>Let me explain what happens in point 4.</p> <p>When we call our original selector, theoretically we skip our swizzled function and go straight to original implementation,<strong> BUT the system calls from this original method other methods we swizzled </strong>for example when you just call removeObserver: for NSNotificationCenter it may call more specific removeObserver:name:object: for each object that is registered.</p> <p>We swizzled original selector to point to our method, so now its important that we proceed carefully. There are 2 cases our removeObserver: methods can be called:</p> <ol> <li>Programmers call removeObserver somewhere from the application code.</li> <li>The methods get called due to original implementation calling different methods. (This will be identified as our method forwarding).</li> </ol> <p>We could try to mimic original behavior in our code by analyzing every call and recreating the algorithm they use <strong>but this could break if apple changes something</strong>, instead I figured out that since code is executed synchronously we can identify both cases, that’s why we have <strong>allowMethodForwarding</strong> property. Look at the code of our removeObserver:</p> <div> <button class='toggle-code' title='show'>Show Code</button><figure class='code hide'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">sf_removeObserver:</span><span class="p">(</span><span class="kt">id</span><span class="p">)</span><span class="nv">observer</span> <span class="nf">forKeyPath:</span><span class="p">(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">keyPath</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'><span class="c1">//! 1</span>
</span><span class='line'>  <span class="k">if</span> <span class="p">([</span><span class="n">self</span> <span class="n">allowMethodForwarding</span><span class="p">])</span> <span class="p">{</span>
</span><span class='line'><span class="cp">#if SF_OBSERVERS_LOG_ORIGINAL_METHODS</span>
</span><span class='line'>    <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;Calling original method %@ with parameters %@ %@&quot;</span><span class="p">,</span> <span class="n">NSObjectKVOSFObserversRemoveSelector</span><span class="p">,</span> <span class="n">observer</span><span class="p">,</span> <span class="n">keyPath</span><span class="p">);</span>
</span><span class='line'><span class="cp">#endif</span>
</span><span class='line'>    <span class="n">objc_msgSend</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">NSSelectorFromString</span><span class="p">(</span><span class="n">NSObjectKVOSFObserversRemoveSelector</span><span class="p">),</span> <span class="n">observer</span><span class="p">,</span> <span class="n">keyPath</span><span class="p">);</span>
</span><span class='line'>    <span class="k">return</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="c1">//! 2</span>
</span><span class='line'>  <span class="n">NSMutableDictionary</span> <span class="o">*</span><span class="n">registeredKeyPaths</span> <span class="o">=</span> <span class="p">(</span><span class="n">NSMutableDictionary</span> <span class="o">*</span><span class="p">)</span><span class="n">objc_getAssociatedObject</span><span class="p">(</span><span class="n">observer</span><span class="p">,</span> <span class="n">AH_BRIDGE</span><span class="p">(</span><span class="n">NSObjectKVOSFObserversArrayKey</span><span class="p">));</span>
</span><span class='line'>  <span class="k">if</span> <span class="p">([</span><span class="n">self</span> <span class="nl">sf_removeObserver:</span><span class="n">observer</span> <span class="nl">forKeyPath:</span><span class="n">keyPath</span> <span class="nl">context:</span><span class="nb">nil</span> <span class="nl">registeredKeyPaths:</span><span class="n">registeredKeyPaths</span><span class="p">])</span> <span class="p">{</span>
</span><span class='line'><span class="cp">#if SF_OBSERVERS_LOG_ORIGINAL_METHODS</span>
</span><span class='line'>      <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;Calling original method %@ with parameters %@ %@&quot;</span><span class="p">,</span> <span class="n">NSObjectKVOSFObserversRemoveSelector</span><span class="p">,</span> <span class="n">observer</span><span class="p">,</span> <span class="n">keyPath</span><span class="p">);</span>
</span><span class='line'><span class="cp">#endif</span>
</span><span class='line'><span class="c1">//! 3</span>
</span><span class='line'>    <span class="p">[</span><span class="n">self</span> <span class="nl">setAllowMethodForwarding:</span><span class="n">YES</span><span class="p">];</span>
</span><span class='line'>    <span class="n">objc_msgSend</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">NSSelectorFromString</span><span class="p">(</span><span class="n">NSObjectKVOSFObserversRemoveSelector</span><span class="p">),</span> <span class="n">observer</span><span class="p">,</span> <span class="n">keyPath</span><span class="p">);</span>
</span><span class='line'>    <span class="p">[</span><span class="n">self</span> <span class="nl">setAllowMethodForwarding:</span><span class="n">NO</span><span class="p">];</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure> </div> <ol> <li>If we are method forwarding just call original selector and return.</li> <li>Check our internal structure if we can remove object ( we prevent removing object that isn’t observer ).</li> <li>Since this is called by our code and not by method forwarding, enable method forwarding in case original code calls other swizzled selectors then disable it afterwards.</li> </ol> <h2>Conclusion</h2> <p>You no longer need to call removeObserver in your dealloc methods, that especially useful when using ARC as you won’t need to create dealloc at all in 95 % classes in your application. You also learned, that you could use <strong>NSSelectorFromString </strong>to prevent compiler from generating warning for dynamically created methods, that <strong>__unsafe_unretained \__block</strong> specifier is the correct way to break retain cycles on code that needs to be run both on ARC and non ARC.</p> <p>Also you can have seen how to be on the safe side when swizzling multiples methods that can call each other by identifing <strong>methodForwarding</strong>, instead of trying to recreate system behavior that could change <strong>at any iOS update.</strong></p> <p>I&#8217;m <a href="http://twitter.com/merowing_">merowing_ on twitter</a> if you feel like talking about it.</p> </div> </article> <div class="share"> <div class="addthis_sharing_toolbox"></div> <script type="text/javascript">
var addthis_share = addthis_share || {}
addthis_share = {
passthrough : {
twitter: {
via: "merowing_",
text: "Great article"
}
}
}
</script> <script type="text/javascript">var addthis_config = {"data_track_addressbar":true};</script> <script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-532368630eb37492" async></script> </div> </div> </div> <footer id="footer" class="inner">Copyright &copy; 2015 Krzysztof Zabłocki Design credit: <a href="http://shashankmehta.in/archive/2012/greyshade.html">Shashank Mehta</a></footer> <script src="/javascripts/slash.js"></script> <script src="/javascripts/code-toggle.js"></script> <script src="/javascripts/jquery.fancybox.pack.js"></script> <script type="text/javascript">
(function($){
	$('.fancybox').fancybox();
})(jQuery);
</script> <script type="text/javascript">
		var _gaq = _gaq || [];
		_gaq.push(['_setAccount', 'UA-29400340-1']);
		_gaq.push(['_trackPageview']);

		(function() {
			var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		})();

		$('a').click(function() { 
			var $a = $(this); var href = $a.attr('href');
			// see if the link is external 
			if ( (href.match(/^http/)) && (! href.match(document.domain)) ) {

			// if so, register an event
			var category = 'outgoing'; // set this to whatever you want
			var event = 'click'; // set this to whatever you want
			var label = href; // set this to whatever you want
			pageTracker._trackEvent(category, event, href);
			}});
	</script> </div> </div> </body> </html>