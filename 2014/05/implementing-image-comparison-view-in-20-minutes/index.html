<!DOCTYPE HTML> <html> <head> <meta charset="utf-8"> <title>Simple Image Comparison View - Krzysztof Zabłocki</title> <meta name="author" content="Krzysztof Zabłocki"> <meta name=”twitter:site” content=”@merowing_> <meta name="description" content="Simple Image Comparison View Did you ever see image split available in Kaleidoscope? It&#8217;s really easy to implement similar one in iOS with &hellip;"> <meta name="HandheldFriendly" content="True"> <meta name="MobileOptimized" content="320"> <meta name="viewport" content="width=device-width, initial-scale=1"> <link href="/atom.xml" rel="alternate" title="Krzysztof Zabłocki" type="application/atom+xml"> <link rel="canonical" href="http://krzysztofzablocki.github.com/krzysztofzablocki/2014/05/implementing-image-comparison-view-in-20-minutes"> <link href="/favicon.png" rel="shortcut icon"> <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css"> <link href="/stylesheets/font-awesome.min.css" media="screen, projection" rel="stylesheet" type="text/css"> <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]--> <link href='http://fonts.googleapis.com/css?family=Nunito:400,300,700' rel='stylesheet' type='text/css'> <script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script> <style type="text/css">
  .fancybox-wrap { position: fixed !important; }
  .fancybox-opened {
    -webkit-border-radius: 4px !important;
       -moz-border-radius: 4px !important;
            border-radius: 4px !important;
  }
  .fancybox-close, .fancybox-prev span, .fancybox-next span {
    background-color: transparent !important;
    border: 0 !important;
  }
</style> <script type="text/javascript">
		var _gaq = _gaq || [];
		_gaq.push(['_setAccount', 'UA-29400340-1']);
		_gaq.push(['_trackPageview']);

		(function() {
			var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		})();

		$('a').click(function() { 
			var $a = $(this); var href = $a.attr('href');
			// see if the link is external 
			if ( (href.match(/^http/)) && (! href.match(document.domain)) ) {

			// if so, register an event
			var category = 'outgoing'; // set this to whatever you want
			var event = 'click'; // set this to whatever you want
			var label = href; // set this to whatever you want
			pageTracker._trackEvent(category, event, href);
			}});
	</script> </head> <body> <div class="container"> <div class="left-col"> <div class="intrude-less"> <header id="header" class="inner"><div class="profilepic"> <script src="/javascripts/md5.js"></script> <script type="text/javascript">
		$(function(){
			$('.profilepic').append("<a href='http://twitter.com/merowing_'><img src='http://www.gravatar.com/avatar/" + MD5("krzysztof.zablocki@pixle.pl") + "?s=120' alt='Profile Picture' style='width: 120px; float: left; margin: 0px 15px 15px 0px;' /></a> <div class='header_bio'><a href='/about/''>Krzysztof Zabłocki - Software Engineer.</a></div>");
		});
	</script> </div> <nav id="main-nav"><ul class="main"> <br/> <br/> <div class="indie_apps" style="clear:both;"> <a href="http://appstore.com/foldify"><img class="app_poster" src="http://www.merowing.info/images/foldify.png" alt="Foldify"></a> <a href="http://appstore.com/foldifyzoo"><img class="app_poster" src="http://www.merowing.info/images/foldifyzoo.png" alt="Foldify Zoo"></a> <a href="http://appstore.com/foldifydino"><img class="app_poster" src="http://www.merowing.info/images/foldifydino.png" alt="Foldify Dino"></a> <a href="https://itunes.apple.com/us/app/storest-kids-love-playing/id926102013?mt=8"><img class="app_poster" src="http://www.merowing.info/images/storest.png" alt="Bord"></a> <a href="http://appstore.com/bord"><img class="app_poster" src="http://www.merowing.info/images/bord.png" alt="Storest"></a> <br/> <br/> </div> <li><a href="/about">About me</a></li> <li><a href="/speaking">Speaking</a></li> <li><a href="/">Blog</a></li> <li><a href="/blog/archives">Archives</a></li> </ul> </nav> <nav id="popular"> <section> <h4>Recommended</h4> <li class="related"><a href="/2014/10/how-do-i-work/">How do I Work?</a></li> <li class="related"><a href="/2014/03/refactoring-tricks">Refactoring tricks</a> and <a href="/2014/02/ios-developer-tools">Developer Tools</a></li> <li class="related"><a href="/2012/04/drawing-smooth-lines-with-cocos2d-ios-inspired-by-paper">Drawing smooth lines</a></li> <li class="related"><a href="https://github.com/krzysztofzablocki/KZPropertyMapper">Data Parsing</a> and <a href="https://github.com/krzysztofzablocki/KZBootstrap">Project bootstrap</a></li> </section> </nav> <nav id="sub-nav"> <div class="social"> <a class="email" href="mailto:krzysztof.zablocki@pixle.pl" title="Email">Email</a> <a class="facebook" href="http://www.facebook.com/100000315956630" title="Facebook">Facebook</a> <a class="twitter" href="http://twitter.com/merowing_" title="Twitter">Twitter</a> <a class="github" href="https://github.com/krzysztofzablocki" title="GitHub">GitHub</a> <a class="linkedin" href="http://www.linkedin.com/profile/view?id=90077810" title="LinkedIn">LinkedIn</a> <a class="rss" href="/atom.xml" title="RSS">RSS</a> </div> </nav></header> </div> </div> <div class="mid-col"> <div class="mid-col-container"> <div id="content" class="inner"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"> <h1 class="title" itemprop="name">Simple Image Comparison View</h1> <div class="entry-content" itemprop="articleBody"><p>Did you ever see image split available in Kaleidoscope? It&#8217;s really easy to implement similar one in iOS with some CoreAnimation code.</p> <p><img src="http://www.merowing.info/uploads/2014/05/ImageSplit.gif" width="180" height="270"></p> <h1>Basic</h1> <ol> <li>Stack 2 UIImageViews on top of each other.</li> <li>Use CAShapeLayer to generate mask to hide part of our top one.</li> <li>Mask will be a simple triangle that changes it&#8217;s extents as we move our finger.</li> </ol> <p><img src="http://www.merowing.info/uploads/2014/05/layersMasked.png" width="160"> <img src="http://www.merowing.info/uploads/2014/05/mask.png" width="160"></p> <p>We only need to create a simple triangle that conveys that. To be able to reduce or increase mask size we need to manipulate topLeft and bottomRight vertices of that triangle. We just need to move them proportionally to our width/height ratio like so:</p> <div> <button class='toggle-code' title='show'>Show Code</button><figure class='code hide'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="k">-</span> <span class="p">(</span><span class="n">CGPathRef</span><span class="p">)</span><span class="nf">pathForMaskingUpToPercentage:</span><span class="p">(</span><span class="n">CGFloat</span><span class="p">)</span><span class="nv">percentage</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'><span class="c1">//! 1.</span>
</span><span class='line'>  <span class="k">const</span> <span class="n">CGFloat</span> <span class="n">width</span> <span class="o">=</span> <span class="n">CGRectGetWidth</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">bounds</span><span class="p">);</span>
</span><span class='line'>  <span class="k">const</span> <span class="n">CGFloat</span> <span class="n">height</span> <span class="o">=</span> <span class="n">CGRectGetHeight</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">bounds</span><span class="p">);</span>
</span><span class='line'>  <span class="k">const</span> <span class="n">CGFloat</span> <span class="n">ratio</span> <span class="o">=</span> <span class="n">width</span> <span class="o">/</span> <span class="n">height</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//! 2.</span>
</span><span class='line'>  <span class="k">const</span> <span class="n">CGFloat</span> <span class="n">min</span> <span class="o">=</span> <span class="n">MAX</span><span class="p">(</span><span class="n">height</span><span class="p">,</span> <span class="n">width</span><span class="p">);</span>
</span><span class='line'>  <span class="k">const</span> <span class="n">CGFloat</span> <span class="n">offset</span> <span class="o">=</span> <span class="o">-</span><span class="n">min</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">min</span> <span class="o">*</span> <span class="n">percentage</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//! 3.</span>
</span><span class='line'>  <span class="n">UIBezierPath</span> <span class="o">*</span><span class="n">bezierPath</span> <span class="o">=</span> <span class="p">[</span><span class="n">UIBezierPath</span> <span class="n">bezierPath</span><span class="p">];</span>
</span><span class='line'>  <span class="p">[</span><span class="n">bezierPath</span> <span class="nl">moveToPoint:</span><span class="n">CGPointMake</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">height</span><span class="p">)];</span>
</span><span class='line'>  <span class="p">[</span><span class="n">bezierPath</span> <span class="nl">addLineToPoint:</span><span class="n">CGPointMake</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span> <span class="o">-</span> <span class="n">offset</span><span class="p">)];</span>
</span><span class='line'>  <span class="p">[</span><span class="n">bezierPath</span> <span class="nl">addLineToPoint:</span><span class="n">CGPointMake</span><span class="p">(</span><span class="n">width</span> <span class="o">+</span> <span class="n">offset</span> <span class="o">*</span> <span class="n">ratio</span><span class="p">,</span> <span class="n">height</span><span class="p">)];</span>
</span><span class='line'>  <span class="p">[</span><span class="n">bezierPath</span> <span class="n">closePath</span><span class="p">];</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">bezierPath</span><span class="p">.</span><span class="n">CGPath</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure> </div> <ol> <li>Calculate screen ratio</li> <li>Grab min which equals to turned-off masking.</li> <li>Expand triangle by using offset and adjusting for screen ratio.</li> </ol> <h1>Driving UIX by GestureRecognizer</h1> <p>We want to be able to drive our masking by using simple pan gesture recognizer, we can implement it as follows:</p> <div> <button class='toggle-code' title='show'>Show Code</button><figure class='code hide'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">handlePanGesture:</span><span class="p">(</span><span class="n">UIPanGestureRecognizer</span> <span class="o">*</span><span class="p">)</span><span class="nv">gestureRecognizer</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'><span class="c1">//! 1.</span>
</span><span class='line'>  <span class="k">const</span> <span class="n">CGPoint</span> <span class="n">location</span> <span class="o">=</span> <span class="p">[</span><span class="n">gestureRecognizer</span> <span class="nl">locationInView:</span><span class="n">self</span><span class="p">];</span>
</span><span class='line'>  <span class="k">const</span> <span class="n">CGFloat</span> <span class="n">width</span> <span class="o">=</span> <span class="n">CGRectGetWidth</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">bounds</span><span class="p">);</span>
</span><span class='line'>  <span class="k">const</span> <span class="n">CGFloat</span> <span class="n">height</span> <span class="o">=</span> <span class="n">CGRectGetHeight</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">bounds</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//! 2.</span>
</span><span class='line'>  <span class="k">const</span> <span class="n">CGFloat</span> <span class="n">distance</span> <span class="o">=</span> <span class="n">sqrtf</span><span class="p">((</span><span class="kt">float</span><span class="p">)(</span><span class="n">location</span><span class="p">.</span><span class="n">x</span> <span class="o">*</span> <span class="n">location</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">pow</span><span class="p">((</span><span class="n">height</span> <span class="o">-</span> <span class="n">location</span><span class="p">.</span><span class="n">y</span><span class="p">),</span> <span class="mi">2</span><span class="p">)));</span>
</span><span class='line'>  <span class="k">const</span> <span class="n">CGFloat</span> <span class="n">maxDistance</span> <span class="o">=</span> <span class="n">sqrtf</span><span class="p">(</span><span class="n">width</span> <span class="o">*</span> <span class="n">width</span> <span class="o">+</span> <span class="n">height</span> <span class="o">*</span> <span class="n">height</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//! 3.</span>
</span><span class='line'>  <span class="n">CGFloat</span> <span class="n">fraction</span> <span class="o">=</span> <span class="n">distance</span> <span class="o">/</span> <span class="n">maxDistance</span><span class="p">;</span>
</span><span class='line'>  <span class="k">const</span> <span class="n">CGPathRef</span> <span class="n">newPath</span> <span class="o">=</span> <span class="p">[</span><span class="n">self</span> <span class="nl">pathForMaskingUpToPercentage:</span><span class="n">fraction</span><span class="p">];</span>
</span><span class='line'>  <span class="n">self</span><span class="p">.</span><span class="n">shapeLayer</span><span class="p">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">newPath</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure> </div> <ol> <li>Just grab values for calculation.</li> <li>Use simple vector math to calculate max allowed distance and the distance to user finger.</li> <li>Calculate how far in normalized distance user finger is, then grab a mask for that percentage and set it on shapeLayer.</li> </ol> <h1>Adding snapping behaviour</h1> <p>It would be nice if when we lifted finger close to screen boundries our mask would snap with animation, we can add that by simply using CoreAnimation and simple math:</p> <div> <button class='toggle-code' title='show'>Show Code</button><figure class='code hide'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="c1">//! 1.</span>
</span><span class='line'><span class="k">const</span> <span class="kt">BOOL</span> <span class="n">isEnding</span> <span class="o">=</span> <span class="n">gestureRecognizer</span><span class="p">.</span><span class="n">state</span> <span class="o">==</span> <span class="n">UIGestureRecognizerStateEnded</span><span class="p">;</span>
</span><span class='line'>  <span class="k">const</span> <span class="n">CGFloat</span> <span class="n">snapMargin</span> <span class="o">=</span> <span class="n">kPathSnapMarginPercentage</span><span class="p">;</span>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="n">isEnding</span> <span class="o">&amp;&amp;</span> <span class="n">fraction</span> <span class="o">&gt;</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="n">snapMargin</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">fraction</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="n">isEnding</span> <span class="o">&amp;&amp;</span> <span class="n">fraction</span> <span class="o">&lt;</span> <span class="n">snapMargin</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">fraction</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">const</span> <span class="n">CGPathRef</span> <span class="n">newPath</span> <span class="o">=</span> <span class="p">[</span><span class="n">self</span> <span class="nl">pathForMaskingUpToPercentage:</span><span class="n">fraction</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//! 2.</span>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="n">isEnding</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">CABasicAnimation</span> <span class="o">*</span><span class="n">pathAnimation</span> <span class="o">=</span> <span class="p">[</span><span class="n">CABasicAnimation</span> <span class="nl">animationWithKeyPath:</span><span class="s">@&quot;path&quot;</span><span class="p">];</span>
</span><span class='line'>    <span class="c1">//! 3.</span>
</span><span class='line'>    <span class="n">pathAnimation</span><span class="p">.</span><span class="n">fromValue</span> <span class="o">=</span> <span class="p">(</span><span class="kt">id</span><span class="p">)</span><span class="n">self</span><span class="p">.</span><span class="n">shapeLayer</span><span class="p">.</span><span class="n">path</span><span class="p">;</span>
</span><span class='line'>    <span class="n">pathAnimation</span><span class="p">.</span><span class="n">toValue</span> <span class="o">=</span> <span class="p">(</span><span class="n">__bridge</span> <span class="kt">id</span><span class="p">)</span><span class="n">newPath</span><span class="p">;</span>
</span><span class='line'>    <span class="n">pathAnimation</span><span class="p">.</span><span class="n">duration</span> <span class="o">=</span> <span class="n">kPathSnappingDuration</span><span class="p">;</span>
</span><span class='line'>    <span class="n">pathAnimation</span><span class="p">.</span><span class="n">timingFunction</span> <span class="o">=</span> <span class="p">[</span><span class="n">CAMediaTimingFunction</span> <span class="nl">functionWithName:</span><span class="n">kCAMediaTimingFunctionEaseInEaseOut</span><span class="p">];</span>
</span><span class='line'>    <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">shapeLayer</span> <span class="nl">addAnimation:</span><span class="n">pathAnimation</span> <span class="nl">forKey:</span><span class="s">@&quot;path&quot;</span><span class="p">];</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="c1">//! 4.</span>
</span><span class='line'>  <span class="n">self</span><span class="p">.</span><span class="n">shapeLayer</span><span class="p">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">newPath</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure> </div> <ol> <li>Verify that user lifted their finger.</li> <li>Add simple path animation to our shape layer.</li> <li>Remember to set fromValue as we will be changing model layer after this animation block, otherwise you&#8217;d have a difference between model and presentation layers.</li> <li>Update model layer.</li> </ol> <p><a href="http://www.merowing.info/2012/07/pinch-to-reveal-animation-like-in-boeing-milestones/">For more masking examples check-out my old article about Pinch to Reveal effect</a></p> <p><a href="https://github.com/krzysztofzablocki/KZImageSplitView">Full source code at GitHub</a></p> <p><a href="http://twitter.com/merowing_">Send me a tweet</a></p> </div> </article> <div class="share"> <div class="addthis_sharing_toolbox"></div> <script type="text/javascript">
var addthis_share = addthis_share || {}
addthis_share = {
passthrough : {
twitter: {
via: "merowing_",
text: "Great article"
}
}
}
</script> <script type="text/javascript">var addthis_config = {"data_track_addressbar":true};</script> <script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-532368630eb37492" async></script> </div> </div> </div> <footer id="footer" class="inner">Copyright &copy; 2015 Krzysztof Zabłocki Design credit: <a href="http://shashankmehta.in/archive/2012/greyshade.html">Shashank Mehta</a></footer> <script src="/javascripts/slash.js"></script> <script src="/javascripts/code-toggle.js"></script> <script src="/javascripts/jquery.fancybox.pack.js"></script> <script type="text/javascript">
(function($){
	$('.fancybox').fancybox();
})(jQuery);
</script> <script type="text/javascript">
		var _gaq = _gaq || [];
		_gaq.push(['_setAccount', 'UA-29400340-1']);
		_gaq.push(['_trackPageview']);

		(function() {
			var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		})();

		$('a').click(function() { 
			var $a = $(this); var href = $a.attr('href');
			// see if the link is external 
			if ( (href.match(/^http/)) && (! href.match(document.domain)) ) {

			// if so, register an event
			var category = 'outgoing'; // set this to whatever you want
			var event = 'click'; // set this to whatever you want
			var label = href; // set this to whatever you want
			pageTracker._trackEvent(category, event, href);
			}});
	</script> </div> </div> </body> </html>