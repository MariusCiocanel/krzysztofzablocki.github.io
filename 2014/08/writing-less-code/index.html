<!DOCTYPE HTML> <html> <head> <meta charset="utf-8"> <title>Writing less code - Krzysztof Zabłocki</title> <meta name="author" content="Krzysztof Zabłocki"> <meta name=”twitter:site” content=”@merowing_> <meta name="description" content="Writing less code What are some of my favorite techniques for cleaner and more readable code? Over the years I’ve become very pedantic when it comes &hellip;"> <meta name="HandheldFriendly" content="True"> <meta name="MobileOptimized" content="320"> <meta name="viewport" content="width=device-width, initial-scale=1"> <link href="/atom.xml" rel="alternate" title="Krzysztof Zabłocki" type="application/atom+xml"> <link rel="canonical" href="http://merowing.info/2014/08/writing-less-code"> <link href="/favicon.png" rel="shortcut icon"> <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css"> <link href="/stylesheets/font-awesome.min.css" media="screen, projection" rel="stylesheet" type="text/css"> <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]--> <link href='http://fonts.googleapis.com/css?family=Nunito:400,300,700' rel='stylesheet' type='text/css'> <script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script> <style type="text/css">
  .fancybox-wrap { position: fixed !important; }
  .fancybox-opened {
    -webkit-border-radius: 4px !important;
       -moz-border-radius: 4px !important;
            border-radius: 4px !important;
  }
  .fancybox-close, .fancybox-prev span, .fancybox-next span {
    background-color: transparent !important;
    border: 0 !important;
  }
</style> <script type="text/javascript">
		var _gaq = _gaq || [];
		_gaq.push(['_setAccount', 'UA-29400340-1']);
		_gaq.push(['_trackPageview']);

		(function() {
			var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		})();

		$('a').click(function() { 
			var $a = $(this); var href = $a.attr('href');
			// see if the link is external 
			if ( (href.match(/^http/)) && (! href.match(document.domain)) ) {

			// if so, register an event
			var category = 'outgoing'; // set this to whatever you want
			var event = 'click'; // set this to whatever you want
			var label = href; // set this to whatever you want
			pageTracker._trackEvent(category, event, href);
			}});
	</script> </head> <body> <div class="container"> <div class="left-col"> <div class="intrude-less"> <header id="header" class="inner"><div class="profilepic"> <script src="/javascripts/md5.js"></script> <script type="text/javascript">
		$(function(){
			$('.profilepic').append("<a href='http://twitter.com/merowing_'><img src='http://www.gravatar.com/avatar/" + MD5("krzysztof.zablocki@pixle.pl") + "?s=120' alt='Profile Picture' style='width: 120px; float: left; margin: 0px 15px 15px 0px;' /></a> <div class='header_bio'><a href='/about/''>Krzysztof Zabłocki - Software Engineer.</a></div>");
		});
	</script> </div> <nav id="main-nav"><ul class="main"> <br/> <br/> <div class="indie_apps" style="clear:both;"> <a href="http://appstore.com/foldify"><img class="app_poster" src="http://www.merowing.info/images/foldify.png" alt="Foldify"></a> <a href="http://appstore.com/foldifyzoo"><img class="app_poster" src="http://www.merowing.info/images/foldifyzoo.png" alt="Foldify Zoo"></a> <a href="http://appstore.com/foldifydino"><img class="app_poster" src="http://www.merowing.info/images/foldifydino.png" alt="Foldify Dino"></a> <a href="https://itunes.apple.com/us/app/storest-kids-love-playing/id926102013?mt=8"><img class="app_poster" src="http://www.merowing.info/images/storest.png" alt="Bord"></a> <a href="http://appstore.com/bord"><img class="app_poster" src="http://www.merowing.info/images/bord.png" alt="Storest"></a> <br/> <br/> </div> <li><a href="/about">About me</a></li> <li><a href="/speaking">Speaking</a></li> <li><a href="/">Blog</a></li> <li><a href="/blog/archives">Archives</a></li> </ul> </nav> <nav id="popular"> <section> <h4>Recommended</h4> <li class="related"><a href="/2014/10/how-do-i-work/">How do I Work?</a></li> <li class="related"><a href="/2014/03/refactoring-tricks">Refactoring tricks</a> and <a href="/2014/02/ios-developer-tools">Developer Tools</a></li> <li class="related"><a href="/2012/04/drawing-smooth-lines-with-cocos2d-ios-inspired-by-paper">Drawing smooth lines</a></li> <li class="related"><a href="https://github.com/krzysztofzablocki/KZPropertyMapper">Data Parsing</a> and <a href="https://github.com/krzysztofzablocki/KZBootstrap">Project bootstrap</a></li> </section> </nav> <nav id="sub-nav"> <div class="social"> <a class="email" href="mailto:krzysztof.zablocki@pixle.pl" title="Email">Email</a> <a class="facebook" href="http://www.facebook.com/100000315956630" title="Facebook">Facebook</a> <a class="twitter" href="http://twitter.com/merowing_" title="Twitter">Twitter</a> <a class="github" href="https://github.com/krzysztofzablocki" title="GitHub">GitHub</a> <a class="linkedin" href="http://www.linkedin.com/profile/view?id=90077810" title="LinkedIn">LinkedIn</a> <a class="rss" href="/atom.xml" title="RSS">RSS</a> </div> </nav></header> </div> </div> <div class="mid-col"> <div class="mid-col-container"> <div id="content" class="inner"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"> <h1 class="title" itemprop="name">Writing less code</h1> <div class="entry-content" itemprop="articleBody"><p>What are some of my favorite techniques for cleaner and more readable code?</p> <p>Over the years I’ve become very pedantic when it comes to code quality.</p> <p>All my projects use -Weverything &amp; <em>treat warnings as error</em> and only selectively disable warnings if there is a valid reason to do so.</p> <p>My code still have bugs every now and then, no way around this, everyone makes mistakes. There are many ways in which one can improve quality and limit bugs, TDD/BDD would be on top of my list.</p> <p>Having tested code doesn’t neccesary equal clean code.</p> <p>I value <strong>Readability</strong> keeping code <strong>DRY</strong> much more important. I can work on a project without tests, but working on a code that’s not readable or was written by copy-paste monkey is going to be dreadful experience.</p> <p>There are many ways in which one can improve Readability and DRY’ness of code:</p> <ul> <li><a href="http://www.merowing.info/2014/03/refactoring-tricks/#.U_bvl1jV6cc">smart refactoring</a>.</li> <li>using <a href="http://www.merowing.info/2014/04/subjective-guide-to-writing-ios-apps-part-2-data-parsing/">self-resolving architecture</a>.</li> <li>using <a href="http://www.objc.io/issue-13/behaviors.html">behaviours</a>.</li> <li><a href="https://www.google.com/?q=improving+readability+of+code">many more</a>.</li> </ul> <p>I’d like to share few techniques I’ve been using to simplify code.</p> <blockquote><p>Before we start looking at examples, be aware that pretty much ANY code technique can be misused, that doesn’t mean you should avoid it altogether.</p></blockquote> <h3><a href="https://github.com/krzysztofzablocki/KZAsserts">KZAsserts</a></h3> <p>Asserts are great for adhearing to first part of the equation, they’ll crash your app, but they are usually stripped in release(they should), so we need to have proper error handling in release code.</p> <p>Naive code would look like this:</p> <div> <button class='toggle-code' title='show'>Show Code</button><figure class='code hide'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="n">NSParameterAssert</span><span class="p">([</span><span class="n">dataFromServer</span> <span class="nl">isKindOfClass:</span><span class="p">[</span><span class="n">NSDictionary</span> <span class="n">class</span><span class="p">]]);</span>
</span><span class='line'><span class="k">if</span> <span class="p">([</span><span class="n">dataFromServer</span> <span class="nl">isKindOfClass:</span><span class="p">[</span><span class="n">NSDictionary</span> <span class="n">class</span><span class="p">]])</span> <span class="p">{</span>
</span><span class='line'>  <span class="o">*</span><span class="n">error</span> <span class="o">=</span> <span class="p">[</span><span class="n">NSError</span> <span class="nl">errorWithDomain:</span><span class="n">MyerrorDomain</span> <span class="nl">code:</span><span class="n">FSProfileParsingFailedError</span> <span class="nl">userInfo:</span><span class="err">@</span><span class="p">{</span><span class="nl">NSLocalizedDescriptionKey:</span> <span class="s">&quot;[dataFromServer isKindOfClass:[NSDictionary class]] failed&quot;</span><span class="p">}];</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="n">NSParameterAssert</span><span class="p">([</span><span class="n">something</span> <span class="nl">isKindOfClass:</span><span class="p">[</span><span class="n">NSString</span> <span class="n">class</span><span class="p">]]);</span>
</span><span class='line'><span class="k">if</span> <span class="p">([</span><span class="n">something</span> <span class="nl">isKindOfClass:</span><span class="p">[</span><span class="n">NSString</span> <span class="n">class</span><span class="p">]])</span> <span class="p">{</span>
</span><span class='line'>  <span class="o">*</span><span class="n">error</span> <span class="o">=</span> <span class="p">[</span><span class="n">NSError</span> <span class="nl">errorWithDomain:</span><span class="n">MyerrorDomain</span> <span class="nl">code:</span><span class="n">FSProfileParsingFailedError</span> <span class="nl">userInfo:</span><span class="err">@</span><span class="p">{</span><span class="nl">NSLocalizedDescriptionKey:</span> <span class="s">&quot;[something isKindOfClass:[NSString class]] failed&quot;</span><span class="p">}];</span>
</span><span class='line'>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure> </div> <p>There is a lot of duplication here, that&#8217;s probably a reason why few people use assertions (I’d rather gauge my eyeballs out than write/read this kind of code).</p> <p>So how could we achive all of the above (and more), but keep code simple and easy to read?</p> <div> <button class='toggle-code' title='show'>Show Code</button><figure class='code hide'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="n">AssertTrueOrReturnError</span><span class="p">([</span><span class="n">dataFromServer</span> <span class="nl">isKindOfClass:</span><span class="p">[</span><span class="n">NSDictionary</span> <span class="n">class</span><span class="p">]]);</span>
</span><span class='line'><span class="n">AssertTrueOrReturnError</span><span class="p">([</span><span class="n">something</span> <span class="nl">isKindOfClass:</span><span class="p">[</span><span class="n">NSString</span> <span class="n">class</span><span class="p">]]);</span>
</span></code></pre></td></tr></table></div></figure> </div> <h2>Preprocesor Macros</h2> <p>Contrary to Apple beliefs (Swift language doc), macros are used for much more than constants (using them for constants is plain wrong).</p> <h4>What are common techniques for leveraging macros ?</h4> <p>Given a macro definition:</p> <div> <figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="cp">#define Macro(param)</span>
</span></code></pre></td></tr></table></div></figure> </div> <p>and a call like</p> <div> <figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="n">Macro</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure> </div> <p>We can:</p> <ol> <li>Generate NSString - <code>@#param</code> turns into <code>@"name"</code></li> <li>Generate unique variable definition by joing symbols - <code>NSString *local_##param = #@param;</code> turns into <code>NSString *local_name = @"name";</code></li> <li>Leverage gcc expression extension for multiple statements with return value - <code>({ result = doSomething(param); result; })</code> can be used as part of other expressions <code>[Macro(name) doSomethingElse]</code></li> <li>Enforce compile time errors and prevent making spelling mistake when using keyPaths/properties - <code>({if(NO){ [self param]; }; #@param;})</code> can be used as <code>keyPath(name)</code> to get keyPath for a property that you can NEVER make a mistake with (because it will throw compile error if an object doesn’t have property called name).</li> </ol> <p>Techniques like this were crucial for my <a href="https://github.com/krzysztofzablocki/KZPropertyMapper">KZPropertyMapper</a> DSL, let’s look at other techniques used there.</p> <p>Example property mapping might look like this:</p> <div> <button class='toggle-code' title='show'>Show Code</button><figure class='code hide'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="p">[</span><span class="n">KZPropertyMapper</span> <span class="nl">mapValuesFrom:</span><span class="n">dictionary</span> <span class="nl">toInstance:</span><span class="n">self</span> <span class="nl">usingMapping:</span><span class="err">@</span><span class="p">{</span>
</span><span class='line'>    <span class="s">@&quot;videoURL&quot;</span> <span class="o">:</span> <span class="n">KZBox</span><span class="p">(</span><span class="n">URL</span><span class="p">,</span> <span class="n">contentURL</span><span class="p">).</span><span class="n">isRequired</span><span class="p">().</span><span class="n">min</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span>
</span><span class='line'>    <span class="s">@&quot;name&quot;</span> <span class="o">:</span> <span class="n">KZProperty</span><span class="p">(</span><span class="n">title</span><span class="p">).</span><span class="n">lengthRange</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">12</span><span class="p">),</span>
</span><span class='line'>    <span class="s">@&quot;videoType&quot;</span> <span class="o">:</span> <span class="n">KZProperty</span><span class="p">(</span><span class="n">type</span><span class="p">),</span>
</span><span class='line'>    <span class="s">@&quot;sub_object&quot;</span> <span class="o">:</span> <span class="err">@</span><span class="p">{</span>
</span><span class='line'>      <span class="s">@&quot;title&quot;</span> <span class="o">:</span> <span class="n">KZProperty</span><span class="p">(</span><span class="n">uniqueID</span><span class="p">),</span>
</span><span class='line'>    <span class="p">},</span>
</span><span class='line'>  <span class="p">}];</span>
</span></code></pre></td></tr></table></div></figure> </div> <p>This little piece of code does a lot of things:</p> <ul> <li>Handle NSNull’s in source data</li> <li>Gracefully handle optional params</li> <li>Executes type conversions eg. string to URL</li> <li>Executes specified validations</li> <li>Generates compile time error if you make mistake in property name</li> <li>Looks awesome, just look at those validators, so clear and readable.</li> </ul> <p>I’d say that’s quite a lot of bang for a buck. <strong>How can it do it</strong>?</p> <ol> <li>Macro’s</li> <li>Chainable DSL for validators</li> <li>Key Value Coding</li> <li>Runtime</li> </ol> <p>Macro’s we already discussed, KZBox/KZProperty are macros that use above techniques.</p> <h2>DSL for validators.</h2> <p>I bet you appreciate how readable and easy to use validators are. Imagine them written as standard objc method calls, it wouldn’t be as easy to write or read. Instead of nice</p> <div> <figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="s">@&quot;videoURL&quot;</span> <span class="o">:</span> <span class="n">KZBox</span><span class="p">(</span><span class="n">URL</span><span class="p">,</span> <span class="n">contentURL</span><span class="p">).</span><span class="n">isRequired</span><span class="p">().</span><span class="n">min</span><span class="p">(</span><span class="mi">10</span><span class="p">).</span><span class="n">startsWith</span><span class="p">(</span><span class="s">@&quot;http://myapi.com&quot;</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure> </div> <p>Even if I used same smart technqiues for chaining I’d still have lots of <code>[]</code> symbols, likes of:</p> <div> <figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="s">@&quot;videoURL&quot;</span> <span class="o">:</span> <span class="p">[[[</span><span class="n">KZBox</span><span class="p">(</span><span class="n">URL</span><span class="p">,</span> <span class="n">contentURL</span><span class="p">)</span> <span class="n">isRequired</span><span class="p">]</span> <span class="nl">min:</span><span class="mi">10</span><span class="p">]</span> <span class="nl">startsWith:</span><span class="s">@&quot;http://myapi.com&quot;</span><span class="p">]</span>
</span></code></pre></td></tr></table></div></figure> </div> <p>This code is not as easy to change, if you wanted to remove or add validation you need to jump between end and start of the definition. Not to mention one can only take so many <code>[]</code>.</p> <p>We can achieve simple and chainable DSL like the above one by leveraging <em>properties</em> along with <em>blocks</em>:</p> <div> <figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="k">@property</span><span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">copy</span><span class="p">,</span> <span class="n">readonly</span><span class="p">)</span> <span class="n">KZPropertyDescriptor</span> <span class="o">*</span><span class="p">(</span><span class="o">^</span><span class="n">length</span><span class="p">)(</span><span class="n">NSInteger</span> <span class="n">length</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure> </div> <p>then by calling</p> <div> <figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="s">@&quot;videoURL&quot;</span> <span class="o">:</span> <span class="n">KZBox</span><span class="p">(</span><span class="n">URL</span><span class="p">,</span> <span class="n">contentURL</span><span class="p">).</span><span class="n">isRequired</span><span class="p">().</span><span class="n">min</span><span class="p">(</span><span class="mi">10</span><span class="p">).</span><span class="n">startsWith</span><span class="p">(</span><span class="s">@&quot;http://myapi.com&quot;</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure> </div> <p>What we are actually doing is accessing some block properties and executing them, but how are those block set ?</p> <p>Very simply:</p> <div> <button class='toggle-code' title='show'>Show Code</button><figure class='code hide'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="k">-</span> <span class="p">(</span><span class="n">KZPropertyDescriptor</span> <span class="o">*</span> <span class="p">(</span><span class="o">^</span><span class="p">)(</span><span class="n">NSUInteger</span> <span class="n">length</span><span class="p">))</span><span class="nf">length</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="k">return</span> <span class="o">^</span><span class="p">(</span><span class="n">NSUInteger</span> <span class="n">number</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="p">[</span><span class="n">self</span> <span class="nl">addValidatorWithName:</span><span class="s">@&quot;length&quot;</span> <span class="nl">validation:</span><span class="o">^</span><span class="kt">BOOL</span><span class="p">(</span><span class="n">NSString</span> <span class="o">*</span><span class="n">value</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="k">return</span> <span class="n">value</span><span class="p">.</span><span class="n">length</span> <span class="o">==</span> <span class="n">number</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}];</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">self</span><span class="p">;</span>
</span><span class='line'>  <span class="p">};</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure> </div> <ol> <li>return a block that matches our property definition</li> <li>when that block is executed we add a new validator with a 1-liner validation block</li> <li>our block returns self so that we can chain another validator on top of it.</li> </ol> <p><a href="https://github.com/krzysztofzablocki/KZPropertyMapper/blob/master/KZPropertyMapper/KZPropertyDescriptor%2BValidators.m">Just take a look at other validators here</a>.</p> <h2>Key Value Coding</h2> <p>Key value coding is really cool technique that I use in normal code but also very often while debugging.</p> <p>KVC allows us to leverage:</p> <ul> <li>automatic boxing / unboxing of primitive types (eg. change int into NSNumber and viceversa)</li> <li>collection operators like <strong>sum/avg/max</strong></li> <li>more complex operators like <strong>unionOfObjects</strong></li> <li>extract only interesting attributes</li> <li><strong>ALL of the above can be applied on subobjects</strong></li> </ul> <p>Examples:</p> <p>Instead of:</p> <div> <button class='toggle-code' title='show'>Show Code</button><figure class='code hide'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="k">-</span> <span class="p">(</span><span class="n">CGFloat</span><span class="p">)</span><span class="nf">before:</span><span class="p">(</span><span class="n">NSArray</span> <span class="o">*</span><span class="p">)</span><span class="nv">charts</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="n">CGFloat</span> <span class="n">maxValue</span> <span class="o">=</span> <span class="n">CGFLOAT_MIN</span><span class="p">;</span>
</span><span class='line'>  <span class="k">for</span><span class="p">(</span><span class="n">HRBBarGraphChartDescriptor</span> <span class="o">*</span><span class="n">chart</span> <span class="k">in</span> <span class="n">charts</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">maxValue</span> <span class="o">=</span> <span class="n">fmaxf</span><span class="p">(</span><span class="n">chart</span><span class="p">.</span><span class="n">value</span><span class="p">.</span><span class="n">floatValue</span><span class="p">,</span> <span class="n">maxValue</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">maxValue</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure> </div> <p>We do:</p> <div> <button class='toggle-code' title='show'>Show Code</button><figure class='code hide'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="k">-</span> <span class="p">(</span><span class="n">CGFloat</span><span class="p">)</span><span class="nf">after:</span><span class="p">(</span><span class="n">NSArray</span> <span class="o">*</span><span class="p">)</span><span class="nv">charts</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="k">return</span> <span class="p">[[</span><span class="n">charts</span> <span class="nl">valueForKeyPath:</span><span class="s">@&quot;@max.value&quot;</span><span class="p">]</span> <span class="n">floatValue</span><span class="p">];</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure> </div> <p>Unique elements from a sub-collection? Instead of:</p> <div> <button class='toggle-code' title='show'>Show Code</button><figure class='code hide'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="c1">//! We could use set operations here, but it&#39;s just trading speed with memory usage</span>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">id</span> <span class="o">&lt;</span><span class="n">NSFastEnumeration</span><span class="o">&gt;</span><span class="p">)</span><span class="nf">uniqueElementsBefore</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="n">NSMutableArray</span> <span class="o">*</span><span class="n">allElements</span> <span class="o">=</span> <span class="p">[</span><span class="n">NSMutableArray</span> <span class="n">new</span><span class="p">];</span>
</span><span class='line'>  <span class="k">for</span> <span class="p">(</span><span class="n">ShapeGroup</span> <span class="o">*</span><span class="n">group</span> <span class="k">in</span> <span class="n">_shapeGroups</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">for</span><span class="p">(</span><span class="n">CCSprite</span> <span class="o">*</span><span class="n">element</span> <span class="k">in</span> <span class="n">group</span><span class="p">.</span><span class="n">elements</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">[</span><span class="n">allElements</span> <span class="nl">containsObject:</span> <span class="n">element</span><span class="p">])</span> <span class="p">{</span>
</span><span class='line'>        <span class="p">[</span><span class="n">allElements</span> <span class="nl">addObject:</span><span class="n">element</span><span class="p">];</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="k">return</span> <span class="p">[</span><span class="n">allElements</span> <span class="n">copy</span><span class="p">];</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure> </div> <p>Simple:</p> <div> <button class='toggle-code' title='show'>Show Code</button><figure class='code hide'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'> <span class="o">-</span> <span class="p">(</span><span class="kt">id</span> <span class="o">&lt;</span><span class="n">NSFastEnumeration</span><span class="o">&gt;</span><span class="p">)</span><span class="n">uniqueElementsAfter</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="p">[</span><span class="n">_shapeGroups</span> <span class="nl">valueForKeyPath:</span><span class="s">@&quot;@distinctUnionOfArrays.elements&quot;</span><span class="p">];</span>
</span><span class='line'>  <span class="p">}</span>
</span></code></pre></td></tr></table></div></figure> </div> <p>When working with debugger I often want to query some collections for interesting properties, eg. I only want names of Users from coredata object.</p> <div> <figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="n">po</span> <span class="p">[[</span><span class="n">website</span> <span class="nl">valueForKeyPath:</span><span class="s">@&quot;users.name&quot;</span><span class="p">]]</span>
</span></code></pre></td></tr></table></div></figure> </div> <p>KZPM mostly uses KVC ability to box / unbox properties: Collection will only contain NSNumbers, but if your class uses NSInteger or other primitives you can get that conversion for free:</p> <div> <figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="p">[</span><span class="n">self</span> <span class="nl">setValue:</span><span class="err">@</span><span class="mi">2</span> <span class="nl">forKeyPath:</span><span class="s">@&quot;primitiveNSInteger&quot;</span><span class="p">]</span>
</span></code></pre></td></tr></table></div></figure> </div> <h2>Runtime</h2> <p>Meta programming is one of my beloved techniques, I just hate repetition, DRY all the way.</p> <p>Smart runtime usage can give us a lot of power, I wrote about them extensively before:</p> <ul> <li>Dynamically create / override functions and classes: <ul> <li>Automatically pick up classes implementing specific protocol. <a href="http://www.merowing.info/2014/04/subjective-guide-to-writing-ios-apps-part-2-data-parsing/">I wrote about this here</a></li> <li>Intercept methods to log or modify behavior eg. <a href="https://github.com/steipete/Aspects">Aspects</a>.</li> <li>Implement similar functions without repetition: <ul> <li>eg. implementing ActiveRecord style <strong>findByField</strong> would only require a few lines of code for all properties of an object.</li> </ul> </li> <li>Store context data per instance.</li> <li>Resolve methods/classes dynamically. <a href="http://www.merowing.info/2014/04/subjective-guide-to-writing-ios-apps-part-2-data-parsing/">Read here</a></li> </ul> </li> <li>Adding guards around Apple API&#8217;s misuses: <ul> <li><a href="https://gist.github.com/steipete/5664345">accessing UIKit methods from background threads</a></li> <li><a href="https://gist.github.com/jverkoey/10641155">accessing CoreData context from wrong thread</a></li> </ul> </li> <li><a href="https://github.com/krzysztofzablocki/CCNode-SFGestureRecognizers">Adding UIGestureRecognizer support to Cocos2D</a></li> <li>Implement Higher order messaging: <code>[[windowsArray do] setHidesOnDeactivate:YES];</code></li> </ul> <h3>Wrapping up</h3> <p>There are many techniques to keep your code clean and DRY, I hope you find some of the above useful and if you have other favorites ones <a href="http://twitter.com/merowing_">send me a tweet</a> as I’d love to hear about them.</p> </div> </article> <div class="share"> <div class="addthis_sharing_toolbox"></div> <script type="text/javascript">
var addthis_share = addthis_share || {}
addthis_share = {
passthrough : {
twitter: {
via: "merowing_",
text: "Great article"
}
}
}
</script> <script type="text/javascript">var addthis_config = {"data_track_addressbar":true};</script> <script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-532368630eb37492" async></script> </div> </div> </div> <footer id="footer" class="inner">Copyright &copy; 2015 Krzysztof Zabłocki Design credit: <a href="http://shashankmehta.in/archive/2012/greyshade.html">Shashank Mehta</a></footer> <script src="/javascripts/slash.js"></script> <script src="/javascripts/code-toggle.js"></script> <script src="/javascripts/jquery.fancybox.pack.js"></script> <script type="text/javascript">
(function($){
	$('.fancybox').fancybox();
})(jQuery);
</script> <script type="text/javascript">
		var _gaq = _gaq || [];
		_gaq.push(['_setAccount', 'UA-29400340-1']);
		_gaq.push(['_trackPageview']);

		(function() {
			var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		})();

		$('a').click(function() { 
			var $a = $(this); var href = $a.attr('href');
			// see if the link is external 
			if ( (href.match(/^http/)) && (! href.match(document.domain)) ) {

			// if so, register an event
			var category = 'outgoing'; // set this to whatever you want
			var event = 'click'; // set this to whatever you want
			var label = href; // set this to whatever you want
			pageTracker._trackEvent(category, event, href);
			}});
	</script> </div> </div> </body> </html>